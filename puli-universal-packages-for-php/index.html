<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" Puli: Universal Packages for PHP &middot;  Facile.it Engineering" />
  	<meta property="og:site_name" content="Facile.it Engineering" />
  	<meta property="og:url" content="/puli-universal-packages-for-php" />

    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2015-12-15T00:00:00Z" />

    
    <meta property="og:article:tag" content="PHP" />
    
    <meta property="og:article:tag" content="Open Source" />
    
    <meta property="og:article:tag" content="Composer" />
    
    <meta property="og:article:tag" content="Puli" />
    
    <meta property="og:article:tag" content="Package Manager" />
    
    

  <title>
     Puli: Universal Packages for PHP &middot;  Facile.it Engineering
  </title>

    <meta name="description" content="News, repos, tips &amp; trends from the Facile.it Engineering team!" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Facile.it Engineering" />
      
      
    
    <meta name="generator" content="Hugo 0.15" />

    <link rel="canonical" href="/puli-universal-packages-for-php" />

    
    <script>
        
        if (window.location.hostname != "localhost") {
            var _gaq = _gaq || [];
            var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';

            _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
            _gaq.push(['_setAccount', '{.}']);
            _gaq.push(['_gat._anonymizeIp']);
            _gaq.push(['_setDomainName','.facile.it']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        }
    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="blog-logo" href="/"><img src="/images/logo.png" alt="Home" /></a>
  
  
      <a class="menu-button icon-feed" href="/index.xml">&nbsp;&nbsp;Subscribe</a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Puli: Universal Packages for PHP</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2015-12-15T00:00:00Z">
            Dec 15, 2015
          </time>
        
         
          <span class="post-tag small"><a href="/tags/php/">#PHP</a></span>
         
          <span class="post-tag small"><a href="/tags/open-source/">#Open Source</a></span>
         
          <span class="post-tag small"><a href="/tags/composer/">#Composer</a></span>
         
          <span class="post-tag small"><a href="/tags/puli/">#Puli</a></span>
         
          <span class="post-tag small"><a href="/tags/package-manager/">#Package Manager</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<h2 id="composer-e-l-ecosistema-php:7ccd1c230bb39690eee30e08d2071e01">Composer e l&rsquo;ecosistema PHP</h2>

<p>L&rsquo;ecosistema PHP è notevolmente cambiato negli ultimi anni grazie all&rsquo;introduzione di <em>Composer</em>.
Esso ha definito degli standard per risolvere problemi comuni come l&rsquo;autoloading e la gestione di pacchetti e dipendenze.
In questi ultimi anni si è assistito ad un proliferare di numerose componenti software riusabili che hanno significativamente modificato le strategie di sviluppo.</p>

<p>Nonostante Composer si sia evoluto molto, in alcuni contesti le sue funzionalità risultano essere limitanti e incomplete.
I framework e i pacchetti più complessi hanno bisogno di una gestione personalizzata delle dipendenze. Generalmente sono necessarie operazioni di configurazione e registrazione. Ciò è specialmente vero per pacchetti core dei framework come i <em>template engines</em>.
Composer, inoltre, possiede una cattiva gestione delle risorse non PHP. I file di configurazione devono essere gestiti manualmente oppure è necessario adottare standard strettamente legati a ciascun framework.</p>

<h2 id="la-soluzione-puli:7ccd1c230bb39690eee30e08d2071e01">La soluzione: Puli</h2>

<p>A partire dal gennaio 2014 è stato sviluppato <strong>Puli, Universal Packages for PHP</strong>, da Bernhard Schussek.
Puli mira a risolvere i problemi d&rsquo;integrazione menzionati in precedenza creando un <strong>layer d&rsquo;astrazione aggiuntivo tra Composer e l&rsquo;applicazione</strong>. Tale layer consente di gestire le risorse secondo convenzioni indipendenti dai framework. Ciò significa che Puli può essere usato anche dalle applicazioni che non ne fanno uso.
Attualmente Puli è in Beta, la versione stabile non è stata ancora annunciata ma è prevista per l&rsquo;inizio del 2016.
<strong>Puli è stato ideato per affiancare Composer</strong>.</p>

<p>Puli lavora ad un livello più alto per fornire le seguenti funzionalità:</p>

<ul>
<li><a href="#puli-path">Gestione dei path virtuali per risorse non PHP</a>;</li>
<li><a href="#override-puli-path">Overriding dei path virtuali</a>;</li>
<li><a href="#binding-type">Interazione semplificata dei pacchetti con l&rsquo;uso di Binding Type</a>;</li>
<li><a href="#url-generation">Generazione automatica di URL per risorse pubbliche</a>;</li>
<li><a href="#assets-install">Installazione automatica delle risorse pubbliche nelle document root</a>.</li>
</ul>

<h2 id="le-componenti-di-puli:7ccd1c230bb39690eee30e08d2071e01">Le componenti di Puli</h2>

<p>Puli offre svariate funzionalità organizzate nei seguenti componenti:</p>

<ul>
<li>Resource repository</li>
<li>Discovery service</li>
<li>Public resources manager</li>
</ul>

<h3 id="configurazione:7ccd1c230bb39690eee30e08d2071e01">Configurazione</h3>

<p>Nell&rsquo;offire questi servizi, Puli legge e scrive un proprio file di configurazione <code>puli.json</code> presente nella root directory del pacchetto, allo stesso modo del <code>composer.json</code>.</p>

<p>Tale configurazione può essere modificata manualmente oppure utilizzando l&rsquo;<strong>interfaccia CLI di Puli</strong>;
Tale strumento può essere installato da Packagist tramite il pacchetto <code>puli/cli</code>.
Al pari di Composer, sono disponibili archivi Phar per un uso immediato.</p>

<h3 id="installazione:7ccd1c230bb39690eee30e08d2071e01">Installazione</h3>

<p>Affiché le applicazioni possano usare i servizi offerti da Puli è necessario procedere all&rsquo;installazione.
Per applicazioni che non fanno uso di framework è sufficiente abilitare il <em>Composer Plugin</em> <code>puli/composer-plugin</code>.
Quest&rsquo;azione viene svolta da Composer con il comando:</p>

<pre><code>$ composer require puli/composer-plugin:^1.0
</code></pre>

<p>Tale plugin consente di generare atomaticamente la cosiddetta <strong>Puli Factory Class</strong>: componente chiave da cui è possibile accedere a tutti i servizi offerti da Puli.</p>

<p>A questo punto è possibile usare Puli nel modo seguente:</p>

<pre><code class="language-php">require './vendor/autoload.php';

// La costante PULI_FACTORY_CLASS viene 
// definita al &quot;composer install&quot;
$factoryClass = PULI_FACTORY_CLASS;
$factory = new $factoryClass();

$puliRepository = $factory-&gt;createRepository();
$puliDiscovery  = $factory-&gt;createDiscovery($puliRepository);
$puliGenerator  = $factory-&gt;createUrlGenerator($puliDiscovery);
</code></pre>

<h3 id="resource-repository:7ccd1c230bb39690eee30e08d2071e01">Resource repository</h3>

<p>Il resource repository fornisce un <strong>file system virtuale</strong> per accedere alle risorse non PHP.
Ciò consente di localizzare facilmente i file senza conoscere la loro effettiva posizione.</p>

<h4 id="accesso-alle-risorse-con-composer:7ccd1c230bb39690eee30e08d2071e01">Accesso alle risorse con Composer</h4>

<p>Con Composer era frequente scrivere codice di questo tipo:</p>

<pre><code class="language-php">$translationFileName = realpath(__DIR__ . '/../vendor/acme/blog/resources/translation-it.xml');
$translationContent = file_get_contents($translationFileName);
</code></pre>

<p>Tale operazione fa uso di dettagli implementativi: il layout delle directory fornito da Composer. La soluzione non è riusabile nè configurabile.</p>

<p><a name="puli-path"></a></p>

<h4 id="accesso-alle-risorse-con-puli:7ccd1c230bb39690eee30e08d2071e01">Accesso alle risorse con Puli</h4>

<p>Ciascun pacchetto compatibile con Puli può registrare diversi <strong>Path Mapping</strong> utilizzati per tradurre i <strong>percorsi virtuali (Puli path)</strong> in <strong>percorsi reali</strong>.
Tali Path Mapping sono elencati nel <code>puli.json</code> e normalmente sono modificati con il comando Puli CLI <code>map</code>.
Ad esempio, il maintainer di acme/blog può eseguire questo comando per definire un nuovo mapping:</p>

<pre><code>$ puli map /acme/blog resources
</code></pre>

<p>Tale operazione crea un&rsquo;associazione tra il prefisso del path virtuale <code>/acme/blog</code> e la directory <code>resources</code>.</p>

<p>Un ipotetico utilizzatore del pacchetto acme/blog potrà quindi accedere alle risorse nel seguente modo:</p>

<pre><code class="language-php">$puliPath = '/acme/blog/translation-it.xml';
$translationContent = $puliRepository-&gt;get($puliPath)-&gt;getBody();
</code></pre>

<p>È importante notare come i Path mapping siano definiti dal maintainer del pacchetto. Le altre componenti si limitano ad usarli per accedere alle risorse.</p>

<p><a name="override-puli-path"></a></p>

<h4 id="resource-overriding:7ccd1c230bb39690eee30e08d2071e01">Resource overriding</h4>

<p>È tuttavia presente un&rsquo;eccezione a questa regola, tale concetto è alla base del <strong>Resource overriding</strong>.
Immaginiamo di dover lavorare con due pacchetti: A e B.
Il pacchetto B è dipendente dal pacchetto A.
B, tuttavia, vuole personalizzare alcune risorse fornite da A.
Il maintainer di B può quindi rimpiazzare (<em>override</em>) tali risorse aggiungengo nuovi Path Mapping.</p>

<p><a name="binding-type"></a></p>

<h3 id="discovery-service:7ccd1c230bb39690eee30e08d2071e01">Discovery service</h3>

<p>Il componente discovery semplifica l&rsquo;interazione tra pacchetti: consente di condividere le risorse senza codice boilerplate attraverso l&rsquo;uso di <strong>Binding Type</strong>.</p>

<p>Per il componente Discovery i pacchetti sono siddivisi in due categorie:</p>

<ul>
<li><strong>Resource providers</strong>: pacchetti che offrono risorse;</li>
<li><strong>Resource consumers</strong>: pacchetti che richiedono risorse.</li>
</ul>

<p>I Binding Types sono definiti dai resource consumers. Ciascun Binding Type è idendificato da un nome (es. <code>acme/translator/messages</code>).
I resource providers possono quindi associare una o più risorse a tali Binding Type.
<strong>L&rsquo;associazione avviene legando un Puli Path ad un Binding Type</strong>.</p>

<p>I <em>Binding Type</em> sono quindi un&rsquo;interfaccia per la condivisione di risorse.</p>

<h4 id="esempio:7ccd1c230bb39690eee30e08d2071e01">Esempio</h4>

<p>Esaminiamo, con un esempio, l&rsquo;interazione tra due pacchetti: <code>acme/md2html</code> e <code>acme/blog</code>.</p>

<p><code>acme/md2html</code> è un componente per tradurre contenuto Markdown verso pagine Html. Md2html è un sistema configurabile: la resa dell&rsquo;output avviene attraverso template Twig modificabili.</p>

<p><code>acme/blog</code> fornisce tools per la gestione di articoli da blog. Siccome questi ultimi possono essere scritti in Markdown, <code>acme/blog</code> fa uso di <code>acme/md2html</code>.</p>

<p>Il componente <code>acme/blog</code> può personalizzare i template di Md2html in questo modo:</p>

<pre><code class="language-php">$md2html = new Md2Html();
$md2html-&gt;useHeaderTemplate(__DIR__ . '/resources/templates/markdown-header.twig');

$htmlContent = $md2html-&gt;translate('## markdown content');
</code></pre>

<p>Questo approccio ha due svantaggi:</p>

<ul>
<li><code>acme/blog</code> ha la diretta responsabilità di configurare correttamente Md2html utilizzando l&rsquo;API fornita;</li>
<li>Gli utenti di <code>acme/blog</code> non possono modificare facilmente le personalizzazioni apportate a Md2html.</li>
</ul>

<p>Tali problemi possono essere risolti con Puli.</p>

<p>Il mantainer di Md2html decide di rendere il suo pacchetto compatibile con Puli.</p>

<p>Definisce quindi il Binding Type: <code>acme/md2html/header-template</code> con il seguente comando:</p>

<pre><code>$ puli type --define acme/md2html/header-template
</code></pre>

<p>Il maintainer di <code>acme/blog</code> può quindi usare tale Binding Type nel seguente modo:</p>

<pre><code>$ puli map /acme/blog resources
$ puli bind /acme/blog/templates/markdown-header.twig acme/md2html/header-template
</code></pre>

<p>Così <code>acme/md2html</code> può leggere il nuovo template <code>markdown-header.twig</code> in modo trasparente.</p>

<p>Gli utilizzatori di acme/blog che desiderassero modificare tale template hanno due strategie:</p>

<ul>
<li>Modificare l&rsquo;associazione al Binding Type <code>acme/md2html/header-template</code></li>
<li>Sovrascrivere il Puli Path <code>/acme/blog/templates/markdown-header.twig</code> con il meccanismo dell&rsquo;overriding esaminato in precedenza.</li>
</ul>

<p><a name="url-generation"></a></p>

<h3 id="public-resources-manager:7ccd1c230bb39690eee30e08d2071e01">Public resources manager</h3>

<p>Puli gestisce anche le risorse pubbliche, gli assets. In particolare, è in grado di generare path e URL da usare nei template o nei fogli di stile.</p>

<p>Come primo passo, è necessario <strong>registrare i server web che servono tali risorse</strong>.
È possibile aggiungere un nuovo server con il comando:</p>

<pre><code>$ puli server --add localhost public_html
</code></pre>

<p>In questo esempio, <code>localhost</code> è il nome del server, mentre <code>public_html</code> è la sua <em>document root</em>.</p>

<p>Ora è possibile pubblicare delle risorse sul server <code>localhost</code> con il comando:</p>

<pre><code>$ puli publish /acme/blog/public localhost /blog
</code></pre>

<p>Ciò mappa il Puli Path <code>/acme/blog/public</code> alla directory <code>blog</code> della document root del server <code>localhost</code>.</p>

<p>Puli ora ha tutte le informazioni per generare i persorsi delle risorse pubbliche:</p>

<pre><code class="language-php">$puliPath = '/acme/blog/public/images/logo.png';
$url = $puliGenerator-&gt;generateUrl($puliPath);
echo $url; // -&gt; &quot;/blog/images/logo.png&quot;
</code></pre>

<p>L&rsquo;ultima operazione può essere eseguita in un template Twig con l&rsquo;utilizzo dell&rsquo;estensione <code>puli/twig-extension</code>:</p>

<pre><code class="language-twig">&lt;img src=&quot;{{ resource_url('/acme/blog/public/images/logo.png') }}&quot; /&gt;
</code></pre>

<p><a name="assets-install"></a></p>

<h4 id="installazione-delle-risorse:7ccd1c230bb39690eee30e08d2071e01">Installazione delle risorse</h4>

<p>Puli può installare automaticamente le risorse pubbliche nella document root dei web server.</p>

<p>Il comando è il seguente:</p>

<pre><code>$ puli publish --install
Installing /acme/blog/public into public_html via symlink...
</code></pre>

<p>Gli autori di Puli hanno annunciato che <strong>tale funzionalità sarà rimossa da Puli CLI in favore di estensioni Gulp o altri tool simili</strong>.</p>

<h3 id="conclusioni:7ccd1c230bb39690eee30e08d2071e01">Conclusioni</h3>

<p>Abbiamo visto come Puli offra numerose funzionalità aggiuntive rispetto al solo utilizzo di Composer.
Puli è un progetto giovane, nel corso del tempo saranno aggiunte ulteriori funzionalità che lo renderanno ancora più potente.
Per approfondire, la documentazione ufficiale è molto chiara e completa ed è disponibile all&rsquo;indirizzo: <a href="http://docs.puli.io/">http://docs.puli.io/</a>.</p>

    </section>


  <footer class="post-footer">

    
    
    
    
        <figure class="author-image">
          <a class="img" href="https://github.com/taueres" style="background-image: url(http://www.gravatar.com/avatar/b2700e7cbb3c4180f2053ed342bcc9c9?s=250&amp;d=mm&amp;r=x)"><span class="hidden">Sergio Santoro's Picture</span></a>
        </figure>
    

    





<section class="author">
  <h4><a href="/">Sergio Santoro</a></h4>
  
  <p>Sergio Santoro è web developer presso Facile.it. Principali interessi: software testing, protocolli di rete, linguaggi formali, intelligenza artificiale, software libero.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Milano, IT</span>
    <span class="author-link icon-link"><a href="https://github.com/taueres">https://github.com/taueres</a></span>
  </div>
</section>



    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Puli%3a%20Universal%20Packages%20for%20PHP&amp;url=%2fpuli-universal-packages-for-php"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=%2fpuli-universal-packages-for-php"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=%2fpuli-universal-packages-for-php&amp;description=Puli%3a%20Universal%20Packages%20for%20PHP"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=%2fpuli-universal-packages-for-php"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'facile-it';
  var disqus_url = '\/puli-universal-packages-for-php';
  (function() {
    
    if (window.location.hostname != "engineering.facile.it")
      return;
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Facile.it Engineering</a> All rights reserved - 2016</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
</body>
</html>

